<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>예측 시장 (Prediction Market) - AI 헤지펀드</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #131722;
            --bg-card: #1e222d;
            --bg-hover: #2a2e39;
            --text-primary: #d1d4dc;
            --text-secondary: #868b98;
            --text-bright: #ffffff;
            --accent-green: #26a69a;
            --accent-red: #ef5350;
            --accent-blue: #2962ff;
            --accent-purple: #9c27b0;
            --border-color: #2a2e39;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 13px;
        }

        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-bright);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i { color: var(--accent-purple); }

        .nav {
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: var(--bg-hover);
            border-color: var(--accent-blue);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .tab {
            background: none;
            border: none;
            color: var(--text-secondary);
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
        }

        .tab.active {
            color: var(--accent-purple);
            border-bottom-color: var(--accent-purple);
        }

        .tab:hover {
            color: var(--text-bright);
        }

        .topic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .topic-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .topic-card:hover {
            border-color: var(--accent-purple);
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.2);
        }

        .topic-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .topic-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-bright);
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .topic-category {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .topic-description {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .consensus-bar {
            background: var(--bg-secondary);
            border-radius: 4px;
            height: 8px;
            margin-bottom: 12px;
            overflow: hidden;
        }

        .consensus-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-red), var(--accent-green));
            transition: width 0.3s;
        }

        .consensus-info {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
        }

        .consensus-value {
            font-weight: 600;
            color: var(--accent-purple);
        }

        .topic-meta {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
            font-size: 12px;
            color: var(--text-secondary);
        }

        .topic-meta i {
            color: var(--accent-blue);
            margin-right: 4px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-bright);
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: var(--accent-red);
        }

        .prediction-form {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-input {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-purple);
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: var(--bg-card);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--accent-purple);
            cursor: pointer;
        }

        .slider-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent-purple);
            min-width: 60px;
            text-align: right;
        }

        .btn {
            background: var(--accent-purple);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #7b1fa2;
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.3);
        }

        .btn:disabled {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            cursor: not-allowed;
        }

        .ai-predictions {
            margin-top: 20px;
        }

        .ai-prediction-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .ai-prediction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .ai-agent-name {
            font-weight: 600;
            color: var(--accent-blue);
        }

        .ai-prediction-value {
            font-size: 16px;
            font-weight: 700;
            color: var(--accent-green);
        }

        .ai-reasoning {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-purple);
        }

        .leaderboard-table {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        .leaderboard-table th {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            padding: 12px;
            text-align: left;
        }

        .leaderboard-table td {
            padding: 15px 12px;
            border-top: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .rank-medal {
            display: inline-block;
            width: 24px;
            height: 24px;
            line-height: 24px;
            text-align: center;
            border-radius: 50%;
            font-weight: 700;
            font-size: 12px;
        }

        .rank-1 {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
        }

        .rank-2 {
            background: linear-gradient(135deg, #c0c0c0, #e8e8e8);
            color: #000;
        }

        .rank-3 {
            background: linear-gradient(135deg, #cd7f32, #e8a87c);
            color: #000;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            color: var(--accent-purple);
        }
    </style>
</head>
<body>
    <!-- 헤더 -->
    <div class="header">
        <div class="logo">
            <i class="fas fa-chart-line"></i>
            <span>예측 시장 (Prediction Market)</span>
        </div>
        <div class="nav">
            <a href="/" class="nav-btn">
                <i class="fas fa-home"></i> 메인
            </a>
            <button class="nav-btn" onclick="showCreateTopicModal()">
                <i class="fas fa-plus"></i> 새 주제
            </button>
        </div>
    </div>

    <div class="container">
        <!-- 통계 대시보드 -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-label">열린 예측 주제</div>
                <div class="stat-value" id="openTopicsCount">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">총 예측 수</div>
                <div class="stat-value" id="totalPredictions">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">AI 에이전트 참여</div>
                <div class="stat-value" id="aiPredictions">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">투자 시그널</div>
                <div class="stat-value" id="investmentSignals">-</div>
            </div>
        </div>

        <!-- 탭 -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('trending')">
                <i class="fas fa-fire"></i> 트렌딩
            </button>
            <button class="tab" onclick="switchTab('all')">
                <i class="fas fa-list"></i> 모든 주제
            </button>
            <button class="tab" onclick="switchTab('leaderboard')">
                <i class="fas fa-trophy"></i> 리더보드
            </button>
            <button class="tab" onclick="switchTab('signals')">
                <i class="fas fa-signal"></i> 투자 시그널
            </button>
        </div>

        <!-- 트렌딩 탭 -->
        <div id="trendingTab" class="tab-content">
            <div class="topic-grid" id="trendingGrid">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i> 로딩 중...
                </div>
            </div>
        </div>

        <!-- 모든 주제 탭 -->
        <div id="allTab" class="tab-content" style="display: none;">
            <div class="topic-grid" id="allTopicsGrid">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i> 로딩 중...
                </div>
            </div>
        </div>

        <!-- 리더보드 탭 -->
        <div id="leaderboardTab" class="tab-content" style="display: none;">
            <h3 style="margin-bottom: 20px; color: var(--text-bright);">
                <i class="fas fa-trophy"></i> 예측 정확도 순위
            </h3>
            <table class="leaderboard-table" id="leaderboardTable">
                <thead>
                    <tr>
                        <th>순위</th>
                        <th>이름</th>
                        <th>총 예측</th>
                        <th>확정된 예측</th>
                        <th>평균 정확도</th>
                        <th>Brier Score</th>
                    </tr>
                </thead>
                <tbody id="leaderboardBody">
                    <tr>
                        <td colspan="6" class="loading">
                            <i class="fas fa-spinner fa-spin"></i> 로딩 중...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 투자 시그널 탭 -->
        <div id="signalsTab" class="tab-content" style="display: none;">
            <h3 style="margin-bottom: 20px; color: var(--text-bright);">
                <i class="fas fa-signal"></i> 예측 시장 기반 투자 시그널
            </h3>
            <div class="topic-grid" id="signalsGrid">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i> 로딩 중...
                </div>
            </div>
        </div>
    </div>

    <!-- 예측 모달 -->
    <div id="predictionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTopicTitle">-</div>
                <button class="close-btn" onclick="closePredictionModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div id="modalTopicDescription" style="color: var(--text-secondary); margin-bottom: 20px; line-height: 1.6;">
                -
            </div>

            <!-- 예측 폼 -->
            <div class="prediction-form">
                <h4 style="margin-bottom: 15px; color: var(--text-bright);">
                    <i class="fas fa-chart-line"></i> 나의 예측
                </h4>

                <div class="form-group">
                    <label class="form-label">예측 확률 (%)</label>
                    <div class="slider-container">
                        <input type="range" class="slider" id="predictionSlider" min="0" max="100" value="50" oninput="updateSliderValue()">
                        <span class="slider-value" id="sliderValue">50%</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">신뢰도</label>
                    <select class="form-input" id="confidenceSelect">
                        <option value="low">낮음</option>
                        <option value="medium" selected>보통</option>
                        <option value="high">높음</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">근거 (선택사항)</label>
                    <textarea class="form-input" id="reasoningInput" rows="4" placeholder="예측의 근거를 입력하세요..."></textarea>
                </div>

                <button class="btn" onclick="submitPrediction()">
                    <i class="fas fa-check"></i> 예측 제출
                </button>
            </div>

            <!-- 커뮤니티 컨센서스 -->
            <div style="margin-top: 20px;">
                <h4 style="margin-bottom: 15px; color: var(--text-bright);">
                    <i class="fas fa-users"></i> 커뮤니티 컨센서스
                </h4>
                <div id="consensusInfo">
                    <div class="loading">로딩 중...</div>
                </div>
            </div>

            <!-- AI 에이전트 예측 -->
            <div class="ai-predictions" id="aiPredictionsSection">
                <h4 style="margin-bottom: 15px; color: var(--text-bright);">
                    <i class="fas fa-robot"></i> AI 에이전트 예측
                </h4>
                <div id="aiPredictionsList">
                    <div class="loading">로딩 중...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentTopicId = null;

        // 페이지 로드 시 실행
        document.addEventListener('DOMContentLoaded', async () => {
            await loadDashboard();
            await loadTrendingTopics();
        });

        // 대시보드 통계 로드
        async function loadDashboard() {
            try {
                const response = await axios.get('/api/prediction/dashboard');
                const data = response.data;

                if (data.success) {
                    document.getElementById('openTopicsCount').textContent = data.open_topics_consensus.length;
                    document.getElementById('totalPredictions').textContent = data.recent_activity.length;
                    document.getElementById('investmentSignals').textContent = data.investment_signals.length;

                    // AI 예측 수 (샘플)
                    const aiCount = data.recent_activity.filter(p => p.predictor_type === 'ai_agent').length;
                    document.getElementById('aiPredictions').textContent = aiCount;
                }
            } catch (error) {
                console.error('대시보드 로드 실패:', error);
            }
        }

        // 트렌딩 주제 로드
        async function loadTrendingTopics() {
            try {
                const response = await axios.get('/api/prediction/trending');
                const topics = response.data.trending_topics || [];

                const grid = document.getElementById('trendingGrid');

                if (topics.length === 0) {
                    grid.innerHTML = '<div class="empty-state"><i class="fas fa-inbox"></i><p>아직 예측 주제가 없습니다</p></div>';
                    return;
                }

                grid.innerHTML = topics.map(topic => renderTopicCard(topic)).join('');
            } catch (error) {
                console.error('트렌딩 주제 로드 실패:', error);
                document.getElementById('trendingGrid').innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>로드 실패</p></div>';
            }
        }

        // 모든 주제 로드
        async function loadAllTopics() {
            try {
                const response = await axios.get('/api/prediction/topics?status=open&limit=50');
                const topics = response.data.topics || [];

                const grid = document.getElementById('allTopicsGrid');

                if (topics.length === 0) {
                    grid.innerHTML = '<div class="empty-state"><i class="fas fa-inbox"></i><p>아직 예측 주제가 없습니다</p></div>';
                    return;
                }

                grid.innerHTML = topics.map(topic => renderTopicCard(topic)).join('');
            } catch (error) {
                console.error('모든 주제 로드 실패:', error);
            }
        }

        // 리더보드 로드
        async function loadLeaderboard() {
            try {
                const response = await axios.get('/api/prediction/leaderboard?limit=50');
                const performers = response.data.leaderboard || [];

                const tbody = document.getElementById('leaderboardBody');

                if (performers.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="empty-state">아직 데이터가 없습니다</td></tr>';
                    return;
                }

                tbody.innerHTML = performers.map((p, index) => {
                    const rank = index + 1;
                    const rankBadge = rank <= 3 ? `<span class="rank-medal rank-${rank}">${rank}</span>` : rank;

                    return `
                        <tr>
                            <td>${rankBadge}</td>
                            <td>${p.agent_name || p.user_id || '익명'}</td>
                            <td>${p.total_predictions || 0}</td>
                            <td>${p.resolved_predictions || 0}</td>
                            <td style="color: var(--accent-green); font-weight: 600;">${(p.avg_accuracy || 0).toFixed(1)}%</td>
                            <td>${(p.avg_brier_score || 0).toFixed(3)}</td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                console.error('리더보드 로드 실패:', error);
            }
        }

        // 투자 시그널 로드
        async function loadSignals() {
            try {
                const response = await axios.get('/api/prediction/signals');
                const signals = response.data.signals || [];

                const grid = document.getElementById('signalsGrid');

                if (signals.length === 0) {
                    grid.innerHTML = '<div class="empty-state"><i class="fas fa-inbox"></i><p>아직 투자 시그널이 없습니다</p></div>';
                    return;
                }

                grid.innerHTML = signals.map(signal => renderSignalCard(signal)).join('');
            } catch (error) {
                console.error('투자 시그널 로드 실패:', error);
            }
        }

        // 주제 카드 렌더링
        function renderTopicCard(topic) {
            const consensus = topic.avg_prediction || 50;
            const deadline = new Date(topic.deadline).toLocaleDateString('ko-KR');

            return `
                <div class="topic-card" onclick="openPredictionModal(${topic.id})">
                    <div class="topic-header">
                        <div style="flex: 1;">
                            <div class="topic-title">${topic.title}</div>
                            <div class="topic-description">${topic.description || ''}</div>
                        </div>
                        <div class="topic-category">${getCategoryName(topic.category)}</div>
                    </div>

                    <div class="consensus-bar">
                        <div class="consensus-fill" style="width: ${consensus}%"></div>
                    </div>

                    <div class="consensus-info">
                        <span>커뮤니티 컨센서스</span>
                        <span class="consensus-value">${consensus.toFixed(1)}%</span>
                    </div>

                    <div class="topic-meta">
                        <span><i class="fas fa-users"></i> ${topic.prediction_count || 0}명 참여</span>
                        <span><i class="fas fa-calendar"></i> ${deadline} 마감</span>
                    </div>
                </div>
            `;
        }

        // 시그널 카드 렌더링
        function renderSignalCard(signal) {
            const tickers = signal.related_tickers ? signal.related_tickers.join(', ') : '-';
            const strength = signal.signal_strength || 'neutral';
            const strengthColor = strength.includes('bullish') ? 'var(--accent-green)' : 'var(--accent-red)';

            return `
                <div class="topic-card">
                    <div class="topic-title">${signal.title}</div>
                    <div class="topic-description">관련 종목: ${tickers}</div>

                    <div style="margin: 15px 0;">
                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 5px;">시그널 강도</div>
                        <div style="font-size: 18px; font-weight: 700; color: ${strengthColor};">
                            ${getSignalStrengthText(strength)}
                        </div>
                    </div>

                    <div class="consensus-bar">
                        <div class="consensus-fill" style="width: ${signal.consensus_probability}%"></div>
                    </div>

                    <div class="consensus-info">
                        <span>컨센서스 확률</span>
                        <span class="consensus-value">${signal.consensus_probability.toFixed(1)}%</span>
                    </div>
                </div>
            `;
        }

        // 예측 모달 열기
        async function openPredictionModal(topicId) {
            currentTopicId = topicId;

            try {
                const response = await axios.get(`/api/prediction/topics/${topicId}`);
                const data = response.data;

                if (!data.success) {
                    alert('주제를 불러올 수 없습니다');
                    return;
                }

                const topic = data.topic;
                const consensus = data.consensus;
                const aiPredictions = data.ai_predictions || [];

                document.getElementById('modalTopicTitle').textContent = topic.title;
                document.getElementById('modalTopicDescription').textContent = topic.description || '';

                // 커뮤니티 컨센서스
                if (consensus) {
                    document.getElementById('consensusInfo').innerHTML = `
                        <div style="background: var(--bg-secondary); padding: 15px; border-radius: 6px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>평균 예측</span>
                                <span style="font-weight: 700; color: var(--accent-purple);">${(consensus.avg_prediction || 0).toFixed(1)}%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>참여자 수</span>
                                <span>${consensus.total_predictions || 0}명</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>인간: ${(consensus.human_avg || 0).toFixed(1)}% (${consensus.human_count}명)</span>
                                <span>AI: ${(consensus.ai_avg || 0).toFixed(1)}% (${consensus.ai_count}개)</span>
                            </div>
                        </div>
                    `;
                }

                // AI 에이전트 예측
                if (aiPredictions.length > 0) {
                    document.getElementById('aiPredictionsList').innerHTML = aiPredictions.map(p => `
                        <div class="ai-prediction-item">
                            <div class="ai-prediction-header">
                                <span class="ai-agent-name">${p.agent_name}</span>
                                <span class="ai-prediction-value">${p.prediction_value.toFixed(1)}%</span>
                            </div>
                            <div class="ai-reasoning">${p.reasoning || '근거 없음'}</div>
                        </div>
                    `).join('');
                } else {
                    document.getElementById('aiPredictionsList').innerHTML = '<div class="empty-state" style="padding: 20px;">아직 AI 예측이 없습니다</div>';
                }

                document.getElementById('predictionModal').classList.add('active');

            } catch (error) {
                console.error('주제 로드 실패:', error);
                alert('주제를 불러올 수 없습니다: ' + error.message);
            }
        }

        // 예측 모달 닫기
        function closePredictionModal() {
            document.getElementById('predictionModal').classList.remove('active');
            currentTopicId = null;
        }

        // 슬라이더 값 업데이트
        function updateSliderValue() {
            const value = document.getElementById('predictionSlider').value;
            document.getElementById('sliderValue').textContent = value + '%';
        }

        // 예측 제출
        async function submitPrediction() {
            if (!currentTopicId) return;

            const predictionValue = parseFloat(document.getElementById('predictionSlider').value);
            const confidence = document.getElementById('confidenceSelect').value;
            const reasoning = document.getElementById('reasoningInput').value;

            try {
                const response = await axios.post('/api/prediction/predictions', {
                    topic_id: currentTopicId,
                    prediction_value: predictionValue,
                    confidence_level: confidence,
                    reasoning: reasoning || null
                });

                if (response.data.success) {
                    alert('예측이 제출되었습니다!');
                    closePredictionModal();
                    await loadDashboard();
                    await loadTrendingTopics();
                } else {
                    alert('예측 제출 실패: ' + (response.data.error || '알 수 없는 오류'));
                }
            } catch (error) {
                console.error('예측 제출 실패:', error);
                alert('예측 제출 실패: ' + error.message);
            }
        }

        // 탭 전환
        function switchTab(tabName) {
            // 탭 버튼 활성화
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // 탭 콘텐츠 표시/숨김
            document.getElementById('trendingTab').style.display = tabName === 'trending' ? 'block' : 'none';
            document.getElementById('allTab').style.display = tabName === 'all' ? 'block' : 'none';
            document.getElementById('leaderboardTab').style.display = tabName === 'leaderboard' ? 'block' : 'none';
            document.getElementById('signalsTab').style.display = tabName === 'signals' ? 'block' : 'none';

            // 필요한 데이터 로드
            if (tabName === 'all') loadAllTopics();
            if (tabName === 'leaderboard') loadLeaderboard();
            if (tabName === 'signals') loadSignals();
        }

        // 헬퍼 함수들
        function getCategoryName(category) {
            const names = {
                'stock': '주식',
                'economy': '경제',
                'culture': '문화',
                'tech': '기술',
                'politics': '정치',
                'other': '기타'
            };
            return names[category] || category;
        }

        function getSignalStrengthText(strength) {
            const texts = {
                'strong_bullish': '강력 매수',
                'bullish': '매수',
                'neutral': '중립',
                'bearish': '매도',
                'strong_bearish': '강력 매도'
            };
            return texts[strength] || strength;
        }

        // 주제 생성 모달 (TODO)
        function showCreateTopicModal() {
            alert('주제 생성 기능은 곧 추가됩니다!');
        }
    </script>
</body>
</html>
